$(document).ready(function(){function e(){$.ajax({type:"ajax",url:`${u}/chat/get_notif?sender=${sender}`,dataType:"JSON",success:function(e){var t,s="";for(t=0;t<e.length;t++)"yes"==e[t].unread_message&&(s+='<i style="color:red;" class="fa fa-asterisk"></i>',"block"===$("#chat_window").css("display")&&(d(),n(),a()));$("#show_notification").html(s)}})}function t(){$.ajax({type:"ajax",url:`${u}/chat/set_unread`,dataType:"JSON",data:{sender:sender},success:function(e){console.log("set_unread")}})}function a(){$.ajax({type:"ajax",url:`${u}/chat/remove_notif?sender=${sender}`,dataType:"JSON",success:function(e){console.log("unset_unread")}})}function s(){var e=$("#sender").val(),t="",a=$("#message").val();t+=`<div class="d-flex justify-content-end mb-4">
               <div class="msg_container_send">
                 <span class="message_sender">${user} </span><br>
                   ${a}
                 <span class="msg_time_send">${$.format.date(new Date,"MMM d, HH:mm ")}</span>
               </div>
               <div class="img_cont_msg">
                 <img src="${baseurl}${avatar}"class="rounded-circle user_img_msg">
               </div>
             </div>`,$("#show_chat").append(t),n(),$.ajax({type:"POST",url:`${u}/chat/send_message`,data:{sender:e,message:a},success:function(e){$('[name="message"]').val("")}})}function n(){var e=$("#show_chat"),t=e.get(0).scrollHeight;e.animate({scrollTop:t},"slow")}function d(){var e=$.format.date(new Date,"MMddyyyy"),t=`${baseurl}assets/images/`;$.ajax({type:"ajax",url:`${u}/chat/show_chat`,dataType:"json",data:{sender:sender,today:e},success:function(e){var a,s=``;for(a=0;a<e.length;a++)e[a].sender==sender?(s+=`<div class="d-flex justify-content-end mb-4"><div class="msg_container_send"><span class="message_sender">${e[a].user_name}</span><br>`,s+=e[a].atch!=``?e[a].atch.indexOf("jpg")>-1||e[a].atch.indexOf("png")>-1||e[a].atch.indexOf("gif")>-1||e[a].atch.indexOf("bmp")>-1?`<a class="image_chat" data-image="${e[a].atch}" href="javascript:void(0);"><img width="100%" src="${t}${e[a].atch}"></a><br>${e[a].message}`:e[a].atch.indexOf("mp4")>-1||e[a].atch.indexOf("flv")>-1||e[a].atch.indexOf("avi")>-1?`<video width="100%" controls><source src="${t}${e[a].atch}" type="video/mp4">Your browser does not support video</video><span class="media-caption">${e[a].atch}</span><br>${e[a].message}`:e[a].atch.indexOf(".mp3")>-1?`<audio controls><source src="${t}${e[a].atch}" type="audio/mp3">Your browser does not support video</audio><span class="media-caption">${e[a].atch}</span><br>${e[a].message}`:e[a].atch.indexOf(".exe")>-1?`<span class="doc_chat"><a href="${t}${e[a].atch}"><i style="color:#5e8bc3;" class="fa fa-file-windows"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].atch.indexOf(".zip")>-1||e[a].atch.indexOf(".rar")>-1?`<span class="doc_chat"><a href="${t}${e[a].atch}"><i style="color:#5e8bc3;" class="fa fa-file-archive-o"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].atch.indexOf(".pdf")>-1?`<span class="doc_chat"><a href="${t}${e[a].atch}"><i style="color:rgb(255, 0, 0);" class="fa fa-file-pdf-o"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].atch.indexOf(".doc")>-1?`<span class="doc_chat"><a href="${t}${e[a].atch}"><i style="color:rgb(0, 0, 255);" class="fa fa-file-word-o"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].atch.indexOf(".xls")>-1?`<span class="doc_chat"><a target="_blank" href="${t}${e[a].atch}"><i style="color:rgb(0, 255, 0);" class="fa fa-file-excel-o"></i> ${e[a].atch}</a></span>${e[a].message}`:`<span class="doc_chat"><a target="_blank" href="${t}${e[a].atch}"><i style="color:rgb(0, 0, 0);" class="fa fa-question-circle"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].message,s+=`<span class="msg_time_send">${$.format.date(e[a].sent_date,"MMM d, HH:mm")}</span></div><div class="img_cont_msg"><img src="${baseurl}${e[a].avatar}" class="rounded-circle user_img_msg"></div></div>`):(s+=`<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="${baseurl}${e[a].avatar}" class="rounded-circle user_img_msg"></div><div class="msg_container"><span class="received_message_sender">${e[a].user_name}</span><br>`,s+=e[a].atch!=``?e[a].atch.indexOf("jpg")>-1||e[a].atch.indexOf("png")>-1||e[a].atch.indexOf("gif")>-1||e[a].atch.indexOf("bmp")>-1?`<a class="image_chat" data-image="${e[a].atch}" href="javascript:void(0);"><img width="100%" src="${t}${e[a].atch}"></a><br>${e[a].message}`:e[a].atch.indexOf("mp4")>-1||e[a].atch.indexOf("flv")>-1||e[a].atch.indexOf("avi")>-1?`<video width="100%" controls><source src="${t}${e[a].atch}" type="video/mp4">Your browser does not support video</video><span class="media-caption">${e[a].atch}</span><br>${e[a].message}`:e[a].atch.indexOf(".mp3")>-1?`<audio controls><source src="${t}${e[a].atch}" type="audio/mp3">Your browser does not support video</audio><span class="media-caption">${e[a].atch}</span><br>${e[a].message}`:e[a].atch.indexOf(".exe")>-1?`<span class="doc_chat"><a href="${t}${e[a].atch}"><i style="color:#5e8bc3;" class="fa fa-file-windows"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].atch.indexOf(".zip")>-1||e[a].atch.indexOf(".rar")>-1?`<span class="doc_chat"><a href="${t}${e[a].atch}"><i style="color:#5e8bc3;" class="fa fa-file-archive-o"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].atch.indexOf(".pdf")>-1?`<span class="doc_chat"><a href="${t}${e[a].atch}"><i style="color:rgb(255, 0, 0);" class="fa fa-file-pdf-o"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].atch.indexOf(".doc")>-1?`<span class="doc_chat"><a href="${t}${e[a].atch}"><i style="color:rgb(0, 0, 255);" class="fa fa-file-word-o"></i> ${e[a].atch}</a></span>${e[a].message}`:e[a].atch.indexOf(".xls")>-1?`<span class="doc_chat"><a target="_blank" href="${t}${e[a].atch}"><i style="color:rgb(0, 255, 0);" class="fa fa-file-excel-o"></i> ${e[a].atch}</a></span>${e[a].message}`:`<span class="doc_chat"><a target="_blank" href="${t}${e[a].atch}"><i style="color:rgb(0, 0, 0);" class="fa fa-question-circle"></i> ${e[a].atch}</a></span>${e[a].message}`:`${e[a].message}`,s+=`<span class="msg_time_send">${$.format.date(e[a].sent_date,"MMM d, HH:mm")}</span></div></div>`);$(`#show_chat`).html(s)}})}setInterval(function(){e()},2e4),e(),d(),$("#chat_button").hover(function(){$("#chat_button_icon").css("color","rgba(100, 126, 255, 0.69)")},function(){$("#chat_button_icon").css("color","rgba(0, 126, 255, 0.69)")}),$("#scroll_chat_content").on("click",function(){n()}),$("#show_chat").on("click",".image_chat",function(){var e=$(this).data("image"),t=`<img width="100%" src="${baseurl}assets/images/${e}">`;$("#image_chat_modal").modal("show"),$("#chat_modal_body").html(t)}),$("#file").on("change",function(e){var t=e.target.files[0].name;$("#filename").html(t),console.log(t)}),$("#chat_button").on("click",function(){$("#chat_button").fadeOut("slow"),$("#chat_window").fadeIn(2e3),n(),d(),a()}),$("#close_chat_window").on("click",function(){$("#chat_window").fadeOut("fast"),$("#chat_button").fadeIn(2e3)}),$("#btn_upload").on("click",function(){$("#chat_form").submit()}),$("#chat_form").submit(function(e){e.preventDefault();var a=$("#file").val(),c=$("#message").val();""==a?""!=c&&(s(),t()):$.ajax({url:`${u}/chat/do_upload`,type:"post",data:new FormData(this),processData:!1,contentType:!1,cache:!1,success:function(e){$('[name="file"]').val(""),$("#filename").html(""),d(),n(),t(),$("#message").val("")}})})});

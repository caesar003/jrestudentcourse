$(document).ready(function(){function t(){""!=r?s(pin,r):i()}function s(t,s){$.ajax({type:"post",url:`${u}/syllabus/get_syllabus`,dataType:"json",data:{pin:t,prg:s},success:function(t){var n,a,e="",d="",i=`<p class="lead">Here you can do the following: </p>
            <ul style="list-style-type: square;">
              <li>Click on any topic or indicator (with either new session or edit session opened) to automatically insert it to the field, </li>
              <li>Tick the black square on right side of every indicator (or topic) to indicate discussed topics, or </li>
              <li>Hit the purple pencil button on the top right to change topics for this student.</li>
            </ul>`;for(a=1==s?"English for Kids":2==s?"Elementary Student":3==s?"Junior High School":4==s?"Senior Student":"General English",d="<small>Syllabus for </small>"+a,n=0;n<t.length;n++)e+=0==t[n].topic&&0==t[n].ind?`<div class="col-2 syll_section">${t[n].section}</div>
                      <div class="col-10 syll_section">${t[n].indicator}
                    </div>`:0!=t[n].topic&&0==t[n].ind?1==t[n].status?`<div class="col-2 syll_topic syll_item" data-ind="${t[n].indicator}">
                         <span class="topic_discussed">${t[n].section}.${t[n].topic}</span>
                       </div>
                       <div class="col-8 syll_topic syll_item" data-ind="${t[n].indicator}">
                         <span class="topic_discussed">${t[n].indicator}</span>
                       </div>
                       <div class="col-2 syll_topic">
                         <a href="javascript:void(0);" data-stat="0" data-id="${t[n].id}" data-section="${t[n].section}" data-topic="${t[n].topic}" data-ind="${t[n].ind}" class="btn btn-default btn-sm topic_check">
                           <i class="fa fa-check-square fa-2x"></i>
                         </a>
                       </div>`:`<div class="col-2 syll_topic syll_item" data-ind="${t[n].indicator}">
                          ${t[n].section}.${t[n].topic}</div>
                      <div class="col-8 syll_topic syll_item" data-ind="${t[n].indicator}">${t[n].indicator}</div>
                      <div class="col-2 syll_topic">
                        <a href="javascript:void(0);" data-stat="1" data-id="${t[n].id}" data-section="${t[n].section}" data-topic="${t[n].topic}" data-ind="${t[n].ind}" class="btn btn-default btn-sm topic_check"><i class="fa fa-square fa-2x"></i></a>
                      </div>`:1==t[n].status?`<div class="col-2 syll_ind syll_item" data-ind="(${t[n].section}.${t[n].topic}.${t[n].ind})">
                         <span class="topic_discussed">${t[n].section}.${t[n].topic}.${t[n].ind}</span>
                       </div>
                       <div class="col-8 syll_ind syll_item" data-ind="(${t[n].section}.${t[n].topic}.${t[n].ind})">
                         <span class="topic_discussed">${t[n].indicator}</span>
                       </div>
                       <div class="col-2 syll_ind">
                        <a href="javascript:void(0);" data-stat="0" data-id="${t[n].id}" data-section="${t[n].section}" data-topic="${t[n].topic}" data-ind="${t[n].ind}" class="btn btn-default btn-sm topic_check"><i class="fa fa-check-square fa-2x"></i></a>
                       </div>`:`<div class="col-2 syll_ind syll_item" data-ind="(${t[n].section}.${t[n].topic}.${t[n].ind})">
                            ${t[n].section}.${t[n].topic}.${t[n].ind}
                      </div>
                       <div class="col-8 syll_ind syll_item" data-ind="(${t[n].section}.${t[n].topic}.${t[n].ind})"> ${t[n].indicator} </div>
                        <div class="col-2 syll_ind">
                          <a href="javascript:void(0);" data-stat="1" data-id="${t[n].id}" data-section="${t[n].section}" data-topic="${t[n].topic}" data-ind="${t[n].ind}" class="btn btn-default btn-sm topic_check">
                            <i class="fa fa-square fa-2x"></i>
                          </a>
                        </div>`;$("#program_id").val(s),$("#syllabus_tab_description").html(i),$("#show_syllabus").html(e),$("#syllabus_tab_header").html(d),$("#syll_edit_button_div").html('<button class="btn btn-sm btn-info edit_syllabus"><i class="fas fa-pencil-alt fa-fw"></i> Edit</button>')}})}function n(t,s){$.ajax({type:"post",url:`${u}/syllabus/get_all`,dataType:"json",data:{pin:t,prg:s},success:function(t){var s,n="";for(s=0;s<t.length;s++)n+=0==t[s].topic&&0==t[s].ind?1==t[s].assigned?`<div class="col-2 syll_section">${t[s].section}</div>
                       <div class="col-8 syll_section">${t[s].indicator}</div>
                       <div class="col-2 syll_section">
                         <a href="javascript:void(0);" data-id="${t[s].id}" data-section="${t[s].section}" data-topic="${t[s].topic}" data-ind="${t[s].ind}" data-assignto="0" class="syll_assign btn btn-default btn-sm">
                           <i class="fas fa-check-square fa-2x"></i>
                         </a>
                        </div>`:`<div class="col-2 syll_section">${t[s].section}</div>
                      <div class="col-8 syll_section">${t[s].indicator}</div>
                      <div class="col-2 syll_section">
                        <a href="javascript:void(0);" data-id="${t[s].id}" data-section="${t[s].section}" data-topic="${t[s].topic}" data-ind="${t[s].ind}" data-assignto="1" class="syll_assign btn btn-default btn-sm">
                          <i class="fas fa-square fa-2x"></i>
                        </a>
                      </div>`:0!=t[s].topic&&0==t[s].ind?1==t[s].assigned?`<div class="col-2 syll_topic">${t[s].section}.${t[s].topic}</div>
                       <div class="col-8 syll_topic">${t[s].indicator}</div>
                       <div class="col-2 syll_topic">
                         <a href="javascript:void(0);" data-id="${t[s].id}" data-section="${t[s].section}" data-topic="${t[s].topic}" data-ind="${t[s].ind}" data-assignto="0" class="syll_assign btn btn-default btn-sm">
                           <i class="fas fa-check-square fa-2x"></i>
                         </a>
                       </div>`:`<div class="col-2 syll_topic">${t[s].section}.${t[s].topic}</div>
                       <div class="col-8 syll_topic">${t[s].indicator}</div>
                       <div class="col-2 syll_topic">
                         <a href="javascript:void(0);" data-id="${t[s].id}" data-section="${t[s].section}" data-topic="${t[s].topic}" data-ind="${t[s].ind}" data-assignto="1" class="syll_assign btn btn-default btn-sm">
                           <i class="fas fa-square fa-2x"></i>
                         </a>
                       </div>`:1==t[s].assigned?`<div class="col-2 syll_ind">${t[s].section}.${t[s].topic}.${t[s].ind}</div>
                      <div class="col-8 syll_ind"><span class="assigned">${t[s].indicator}</span></div>
                      <div class="col-2 syll_ind">
                        <a href="javascript:void(0);" data-id="${t[s].id}" data-section="${t[s].section}" data-topic="${t[s].topic}" data-ind="${t[s].ind}" data-assignto="0" class="btn btn-default btn-sm syll_assign">
                          <i class="fa fa-check-square fa-2x"></i>
                        </a>
                      </div>`:`<div class="col-2 syll_ind">${t[s].section}.${t[s].topic}.${t[s].ind}</div>
                      <div class="col-8 syll_ind">${t[s].indicator}</div>
                      <div class="col-2 syll_ind">
                        <a href="javascript:void(0);" data-id="${t[s].id}" data-section="${t[s].section}" data-topic="${t[s].topic}" data-ind="${t[s].ind}" data-assignto="1" class="btn btn-default btn-sm syll_assign">
                          <i class="fa fa-square fa-2x"></i>
                        </a>
                      </div>`;$("#syllabus_edit_div").html(n)}})}function a(t,a,e,d){$.ajax({url:`${u}/syllabus/assign_section`,type:"post",dataType:"json",data:{pin:t,section:a,assign:e},success:function(a){n(t,d),s(t,d)}})}function e(t,a,e,d,i){$.ajax({url:`${u}/syllabus/assign_topic`,type:"post",dataType:"json",data:{pin:t,section:a,topic:e,assign:d},success:function(a){n(t,i),s(t,i)}})}function d(t,a,e,d){$.ajax({url:`${u}/syllabus/assign_indicator`,type:"post",dataType:"json",data:{pin:t,id:a,assign:e},success:function(a){n(t,d),s(t,d)}})}function i(){var t="Choose the syllabus",s=`<div class="col-md-4">
                <ul class="list-group">
                  <li class="list-group-item syllabus-level" data-level="1">Elementary - Kids</li>
                  <li class="list-group-item syllabus-level" data-level="2">Elementary</li>
                  <li class="list-group-item syllabus-level" data-level="3">Junior Student</li>
                  <li class="list-group-item syllabus-level" data-level="4">Senior Student</li>
                  <li class="list-group-item syllabus-level" data-level="5">General English</li>
                </ul>
              </div>
              <div class="col-8">
                Syllabus for this student is still empty. Click on one of these on the left side to see what each of them consists of.</em>
              </div>`;$("#syllabus_tab_header").html(t),$("#show_syllabus").html(s)}function c(t){$.ajax({type:"post",url:`${u}/syllabus/create`,dataType:"json",data:{pin:pin},success:function(s){$.ajax({type:"post",url:`${u}/syllabus/insert`,dataType:"json",data:{pin:pin,level:t},success:function(s){if(1==t||2==t||4==t){var n=0,a=0,e=0,d=0,i=0,c=0;$("#section_1").is(":checked")&&(n=1),$("#section_2").is(":checked")&&(a=2),$("#section_3").is(":checked")&&(e=3),$("#section_4").is(":checked")&&(d=4),$("#section_5").is(":checked")&&(i=5),$("#section_6").is(":checked")&&(c=6);var r,p=[n,a,e,d,i,c];for(r=0;r<p.length;r++)0!=p[r]&&l(pin,p[r])}else if(3==t){var n=0,a=0,e=0,d=0,i=0,c=0,u=0;$("#section_1").is(":checked")&&(n=1),$("#section_2").is(":checked")&&(a=2),$("#section_3").is(":checked")&&(e=3),$("#section_4").is(":checked")&&(d=4),$("#section_5").is(":checked")&&(i=5),$("#section_6").is(":checked")&&(c=6),$("#section_7").is(":checked")&&(u=7);var r,p=[n,a,e,d,i,c,u];for(r=0;r<p.length;r++)0!=p[r]&&l(pin,p[r])}else if(5==t){var n=0,a=0,e=0,d=0,i=0,c=0,u=0,_=0;$("#section_1").is(":checked")&&(n=1),$("#section_2").is(":checked")&&(a=2),$("#section_3").is(":checked")&&(e=3),$("#section_4").is(":checked")&&(d=4),$("#section_5").is(":checked")&&(i=5),$("#section_6").is(":checked")&&(c=6),$("#section_7").is(":checked")&&(u=7),$("#section_8").is(":checked")&&(_=8);var r,p=[n,a,e,d,i,c,u,_];for(r=0;r<p.length;r++)0!=p[r]&&l(pin,p[r])}o(pin,t),$("#create_syllabus_confirm").modal("hide")}})}})}function o(t,n){$.ajax({url:`${u}/syllabus/set_program`,type:"post",dataType:"json",data:{pin:t,level:n},success:function(a){s(t,n)}})}function l(t,s){$.ajax({type:"post",url:`${u}/syllabus/assign`,dataType:"json",data:{pin:t,section:s},success:function(t){console.log("section assigned")}})}var r=$("#program_id").val();t(pin,r),$("#show_syllabus").on("click",".syll_item",function(){var t=$(this).data("ind");if("block"==$("#course_form").css("display")){var s=$("#ma").val(),n=s+" "+t;$("#ma").val(n),$("#ma_html").val(n),$("#ma_prev").html($("#ma_html").val()),$("#ma_prev").fadeIn("fast")}}),$("#show_syllabus").on("click",".topic_check",function(){var t=$(this).data("id"),n=$(this).data("section"),a=$(this).data("topic"),e=$(this).data("ind"),d=$(this).data("stat"),i=$("#program_id").val();0==e?$.ajax({type:"post",url:`${u}/syllabus/check_topic`,dataType:"json",data:{pin:pin,section:n,topic:a,status:d},success:function(t){s(pin,i)}}):$.ajax({type:"POST",url:`${u}/syllabus/check_ind`,dataType:"JSON",data:{pin:pin,id:t,status:d},success:function(t){$.ajax({type:"post",url:`${u}/syllabus/get_this_topic`,dataType:"json",data:{pin:pin,section:n,topic:a,ind:e,status:d},success:function(t){0==t.length?$.ajax({type:"post",url:`${u}/syllabus/check_topic`,dataType:"json",data:{pin:pin,section:n,topic:a,status:d},success:function(t){s(pin,i)}}):$.ajax({type:"post",url:`${u}/syllabus/check_topic_header`,dataType:"json",data:{pin:pin,section:n,topic:a},success:function(t){s(pin,i)}})}})}})}),$("#syll_edit_button_div").on("click",".edit_syllabus",function(){n(pin,r),$("#edit_syllabus_modal").modal("show")}),$("#syllabus_edit_div").on("click",".syll_assign",function(){var t=$(this).data("id"),s=$(this).data("section"),n=$(this).data("topic"),i=$(this).data("ind"),c=r,o=$(this).data("assignto");0==n?a(pin,s,o,c):0!=n&&0==i?e(pin,s,n,o,c):d(pin,t,o,c)}),$("#show_syllabus").on("click",".syllabus-level",function(){var t=$(this).data("level"),s="",n=`Select the suitable sections for the student (or you can simply leave all unchecked and customize them later), then click continue.`;s=1==t?"English for Kids":2==t?"Elementary Student":3==t?"Junior High School":4==t?"Senior Student":"General English",header="Syllabus for "+s,$.ajax({url:`${u}/syllabus/get_sections`,type:"post",dataType:"json",data:{level:t},success:function(s){var a,e=`<div class="col-4">
                    <ul class="list-group">`;for(a=0;a<s.length;a++)e+=`<li class="list-group-item syllabus_section" data-level="${t}" data-section="${s[a].sections}">${s[a].sections}. ${s[a].indicator} <span class="float-right"><input name="section_${s[a].sections}" id="section_${s[a].sections}" type="checkbox"></span></li>`;e+=`</ul>
              </div>
              <div class="col-8">
                <div class="container">
                  <input type="hidden" name="level" id="level" value="${t}">
                  <button class="btn btn-sm btn-success go_back_btn" type="button"><i class="fas fa-angle-double-left fa-fw"></i> Go Back</button>
                  <button class="btn btn-sm btn-primary proceed_btn" id="proceed_btn" type="button">Continue <i class="fas fa-angle-double-right fa-fw"></i></button>
                </div>
                <br>
                <div class="container" id="show_topic">

                </div>
              </div>`,$("#show_syllabus").html(e),$("#syllabus_tab_header").html(header),$("#syllabus_tab_description").html(n)}})}),$("#show_syllabus").on("click",".syllabus_section",function(){$(this).siblings().removeClass("act"),$(this).addClass("act");var t=$(this).data("level"),s=$(this).data("section");$.ajax({url:`${u}/syllabus/get_topics`,type:"post",dataType:"json",data:{level:t,section:s},success:function(t){var s,n="<ul>";for(s=0;s<t.length;s++)n+=`<li>${t[s].sections}.${t[s].topics} - ${t[s].indicator}</li>`;n+="</ul>",$("#show_topic").html(n)}})}),$("#show_syllabus").on("click",".go_back_btn",function(){i(),$("#syllabus_tab_description").html("")}),$("#show_syllabus").on("click",".proceed_btn",function(){var t=$("#level").val(),s="";s=1==t?"Elementary Kids":2==t?"Elementary":3==t?"Junior":4==t?"Senior":"General English";var n=`<p>You would like to create <strong>${s}</strong> for <strong>${pin}</strong>.<br>Continue?</p>`;$("#create_syllabus_confirm").modal("show"),$("#create_syllabus_msg").html(n),$("#prg_id").val(t)}),$("#btn_create_syllabus").on("click",function(){var t=$("#prg_id").val();c(t)})});

$(document).ready(function(){function a(){var a=$("#schedule_date").val();$.ajax({type:"ajax",url:`${u}/schedule/get_schedules`,dataType:"JSON",success:function(e){var t,s="";for(t=0;t<e.length;t++)s+=e[t].table_name==a?'<li class="list-group-item curr"><a class="schedule_list_item  curr_a" href="javascript:void(0);" data-d="'+e[t].table_name+'">'+e[t].table_name+"</a></li>":'<li class="list-group-item"><a class="schedule_list_item" href="javascript:void(0);" data-d="'+e[t].table_name+'">'+e[t].table_name+"</a></li>";$("#schedule_list").html(s)}})}function e(e=$("#schedule_date").val()){var t=e+" 00:00:00";$.ajax({type:"ajax",url:`${u}/schedule/get_schedule?d=${e}`,dataType:"JSON",success:function(s){var d,n="",c="<small>Schedule for</small> "+$.format.date(t,"ddd, MMM D, yyyy"),l=0;for(d=0;d<s.length;d++)l+=1,n+=`<tr>
                      <td rowspan="2" style="text-align:right;"><div>${l}</div></td>
                      <td rowspan="2" style="text-align:left;"><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="name">${s[d].name}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_9">${s[d]._9}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_9r">${s[d]._9r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_9p">${s[d]._9p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_10">${s[d]._10}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_10r">${s[d]._10r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_10p">${s[d]._10p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_11">${s[d]._11}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_11r">${s[d]._11r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_11p">${s[d]._11p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_12">${s[d]._12}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_12r">${s[d]._12r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_12p">${s[d]._12p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_13">${s[d]._13}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_13r">${s[d]._13r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_13p">${s[d]._13p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_14">${s[d]._14}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_14r">${s[d]._14r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_14p">${s[d]._14p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_15">${s[d]._15}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_15r">${s[d]._15r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_15p">${s[d]._15p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_16">${s[d]._16}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_16r">${s[d]._16r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_16p">${s[d]._16p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_17">${s[d]._17}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_17r">${s[d]._17r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_17p">${s[d]._17p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_18">${s[d]._18}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_18r">${s[d]._18r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_18p">${s[d]._18p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_19">${s[d]._19}</div></td>
                      <td><div contentEditable="true" class="edit"  data-id="${s[d].id}" data-col="_19r">${s[d]._19r}</div></td>
                      <td><div contentEditable="true" class="edit"  data-id="${s[d].id}" data-col="_19p">${s[d]._19p}</div></td>
                      <td><div contentEditable="true" class="edit"  data-id="${s[d].id}" data-col="_20">${s[d]._20}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_20r">${s[d]._20r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[d].id}" data-col="_20p">${s[d]._20p}</div></td>
                      <td><a data-id="${s[d].id}" class="btn-sm teacher_delete" href="javascript:void(0);"><i style="color:red;" class="fas fa-trash"></i></a></td>
                      </tr><tr>
                        <td colspan="3">${s[d]._9n}</td>
                        <td colspan="3">${s[d]._10n}</td>
                        <td colspan="3">${s[d]._11n}</td>
                        <td colspan="3">${s[d]._12n}</td>
                        <td colspan="3">${s[d]._13n}</td>
                        <td colspan="3">${s[d]._14n}</td>
                        <td colspan="3">${s[d]._15n}</td>
                        <td colspan="3">${s[d]._16n}</td>
                        <td colspan="3">${s[d]._17n}</td>
                        <td colspan="3">${s[d]._18n}</td>
                        <td colspan="3">${s[d]._19n}</td>
                        <td colspan="3">${s[d]._20n}</td>
                      `;$("#my_schedule").html(n),$("#schedule_header").html(c),a(),$.ajax({type:"POST",url:`${u}/schedule/get_note`,dataType:"JSON",data:{d:e},success:function(a){var e,t="";for(e=0;e<a.length;e++)t+=a[e].note;$("#note").html(t)}})}})}function t(a,t,s,d){$.ajax({type:"post",url:`${u}/schedule/update`,dataType:"json",data:{id:a,col:t,str:s,d:d},success:function(a){$("#nscf").removeClass("alert alert-danger"),$("#nscf").addClass("alert alert-success"),$("#nscf").html("Change saved!"),$("#nscf").fadeIn("fast"),$("#nscf").fadeOut(1e3),e()}})}a(),e(),$("#add_schedule").on("click",function(){var t=$("#schedule_date").val();""==t?($("#nscf").addClass("alert alert-danger"),$("#nscf").fadeIn("fast"),$("#nscf").html("Pick a date!"),$("#nscf").fadeOut(3e3)):$.ajax({type:"POST",url:`${u}/schedule/date_availability`,data:{d:t},success:function(s){"true"==s?($("#nscf").removeClass("alert alert-success"),$("#nscf").addClass("alert alert-danger"),$("#nscf").fadeIn("fast"),$("#nscf").html("Table for <strong>"+t+"</strong> already exists!"),$("#nscf").fadeOut(3e3)):$.ajax({type:"POST",url:`${u}/schedule/add_schedule`,dataType:"JSON",data:{d:t},success:function(s){$.ajax({type:"POST",url:`${u}/schedule/create_schedule`,dataType:"JSON",data:{d:t},success:function(s){$.ajax({type:"POST",url:`${u}/schedule/insert_teachers`,dataType:"JSON",data:{d:t},success:function(s){e(),a(),$("#nscf").removeClass("alert alert-danger"),$("#nscf").addClass("alert alert-success"),$("#nscf").fadeIn("fast"),$("#nscf").html("Table <strong>"+t+"</strong> created!"),$("#nscf").fadeOut(3e3)}})}})}})}})}),$("#schedule_list").on("click",".schedule_list_item",function(){var a=$(this).data("d");e(a),$("#schedule_date").val(a)}),$("#my_schedule").on("focusin",".edit",function(){$(this).addClass("editMode");var a=$(this).data("id"),e=$(this).data("col"),s=$(this).text(),d=$("#schedule_date").val(),n="",c="";$(this).on("focusout",function(){$(this).removeClass("editMode");var l=$(this).text();s!=l&&(e.indexOf("p")==-1&&e.indexOf("r")==-1?(n=e+"n",isNaN(l)?(c="",$.ajax({url:`${u}/schedule/set_nick_name`,type:"post",dataType:"json",data:{id:a,nick_name:c,col:n,d:d},success:function(s){console.log("nick name set"),t(a,e,l,d)}})):$.ajax({url:`${u}/schedule/get_nick_name`,type:"post",dataType:"json",data:{str:l},success:function(s){""!=s&&(c=s[0].nick_name,$.ajax({url:`${u}/schedule/set_nick_name`,type:"post",dataType:"json",data:{id:a,nick_name:c,col:n,d:d},success:function(s){console.log("nick name set"),t(a,e,l,d)}}))}})):t(a,e,l,d))})}),$("#note").on("focusin",function(){$(this).addClass("editMode");var a=$(this).text();$("#schedule_date").val();$("#str").val(a)}),$("#note").on("focusout",function(){$(this).removeClass("editMode");var a=$("#str").val(),t=$(this).text(),s=$("#schedule_date").val();a!=t&&$.ajax({type:"post",url:`${u}/schedule/update_note`,dataType:"json",data:{d:s,str:t},success:function(a){e()}})}),$("#new_teacher_button").on("click",function(){$("#new_teacher_modal").modal("show")}),$("#add_teacher").on("submit",function(a){a.preventDefault();var t=$("#teacher_name").val(),s=$("#schedule_date").val();""==t?($("#ntf").addClass("alert alert-danger"),$("#ntf").html("It can't be empty")):$.ajax({url:`${u}/schedule/add_teacher`,method:"POST",dataType:"JSON",data:{name:t,d:s},success:function(a){$("#new_teacher_modal").modal("hide"),$("#teacher_name").val(""),$("#nscf").removeClass("alert alert-danger"),$("#nscf").addClass("alert alert-success"),$("#nscf").fadeIn("fast"),$("#nscf").html("Teacher added!"),$("#nscf").fadeOut(5e3),e()}})}),$("#my_schedule").on("click",".teacher_delete",function(){var a=$(this).data("id");$("#id").val(a),$("#delete_teacher_modal").modal("show")}),$("#btn_delete_teacher").on("click",function(){var a=$("#id").val(),t=$("#schedule_date").val();$.ajax({type:"POST",url:`${u}/schedule/delete_teacher`,dataType:"JSON",data:{id:a,d:t},success:function(a){$("#delete_teacher_modal").modal("hide"),$("#nscf").removeClass("alert alert-success"),$("#nscf").addClass("alert alert-danger"),$("#nscf").fadeIn("fast"),$("#nscf").html("Teacher removed!"),$("#nscf").fadeOut(5e3),e()}})})});

$(document).ready(function(){function e(){var e=$("#schedule_date").val();$.ajax({type:"ajax",url:`${u}/schedule/get_schedules`,dataType:"JSON",success:function(t){var a,s="";for(a=0;a<t.length;a++)s+=t[a].table_name==e?'<li class="list-group-item curr"><a class="schedule_list_item  curr_a" href="javascript:void(0);" data-d="'+t[a].table_name+'">'+t[a].table_name+"</a></li>":'<li class="list-group-item"><a class="schedule_list_item" href="javascript:void(0);" data-d="'+t[a].table_name+'">'+t[a].table_name+"</a></li>";$("#schedule_list").html(s)}})}function t(t=$("#schedule_date").val()){var a=t+" 00:00:00";$.ajax({type:"ajax",url:`${u}/schedule/get_schedule?d=${t}`,dataType:"JSON",success:function(s){var n,d="",c="<small>Schedule for</small> "+$.format.date(a,"ddd, MMM D, yyyy"),l=0;for(n=0;n<s.length;n++)l+=1,d+=`<tr>
                      <td rowspan="2" style="text-align:right;"><div>${l}</div></td>
                      <td rowspan="2" style="text-align:left;"><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="name">${s[n].name}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_9">${s[n]._9}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_9r">${s[n]._9r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_9p">${s[n]._9p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_10">${s[n]._10}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_10r">${s[n]._10r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_10p">${s[n]._10p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_11">${s[n]._11}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_11r">${s[n]._11r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_11p">${s[n]._11p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_12">${s[n]._12}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_12r">${s[n]._12r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_12p">${s[n]._12p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_13">${s[n]._13}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_13r">${s[n]._13r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_13p">${s[n]._13p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_14">${s[n]._14}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_14r">${s[n]._14r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_14p">${s[n]._14p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_15">${s[n]._15}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_15r">${s[n]._15r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_15p">${s[n]._15p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_16">${s[n]._16}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_16r">${s[n]._16r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_16p">${s[n]._16p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_17">${s[n]._17}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_17r">${s[n]._17r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_17p">${s[n]._17p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_18">${s[n]._18}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_18r">${s[n]._18r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_18p">${s[n]._18p}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_19">${s[n]._19}</div></td>
                      <td><div contentEditable="true" class="edit"  data-id="${s[n].id}" data-col="_19r">${s[n]._19r}</div></td>
                      <td><div contentEditable="true" class="edit"  data-id="${s[n].id}" data-col="_19p">${s[n]._19p}</div></td>
                      <td><div contentEditable="true" class="edit"  data-id="${s[n].id}" data-col="_20">${s[n]._20}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_20r">${s[n]._20r}</div></td>
                      <td><div contentEditable="true" class="edit" data-id="${s[n].id}" data-col="_20p">${s[n]._20p}</div></td>
                      <td><a data-id="${s[n].id}" class="btn-sm teacher_delete" href="javascript:void(0);"><i style="color:red;" class="fas fa-trash"></i></a></td>
                      </tr><tr>
                        <td colspan="3">${s[n]._9n}</td>
                        <td colspan="3">${s[n]._10n}</td>
                        <td colspan="3">${s[n]._11n}</td>
                        <td colspan="3">${s[n]._12n}</td>
                        <td colspan="3">${s[n]._13n}</td>
                        <td colspan="3">${s[n]._14n}</td>
                        <td colspan="3">${s[n]._15n}</td>
                        <td colspan="3">${s[n]._16n}</td>
                        <td colspan="3">${s[n]._17n}</td>
                        <td colspan="3">${s[n]._18n}</td>
                        <td colspan="3">${s[n]._19n}</td>
                        <td colspan="3">${s[n]._20n}</td>
                      `;$("#my_schedule").html(d),$("#schedule_header").html(c),e(),$.ajax({type:"POST",url:`${u}/schedule/get_note`,dataType:"JSON",data:{d:t},success:function(e){var t,a="";for(t=0;t<e.length;t++)a+=e[t].note;$("#note").html(a)}})}})}function a(e,a,s,n){$.ajax({type:"post",url:`${u}/schedule/update`,dataType:"json",data:{id:e,col:a,str:s,d:n},success:function(e){$("#nscf").removeClass("alert alert-danger"),$("#nscf").addClass("alert alert-success"),$("#nscf").html("Change saved!"),$("#nscf").fadeIn("fast"),$("#nscf").fadeOut(1e3),t()}})}e(),t(),$("#add_schedule").on("click",function(){var a=$("#schedule_date").val();""==a?($("#nscf").addClass("alert alert-danger"),$("#nscf").fadeIn("fast"),$("#nscf").html("Pick a date!"),$("#nscf").fadeOut(3e3)):$.ajax({type:"POST",url:`${u}/schedule/date_availability`,data:{d:a},success:function(s){"true"==s?($("#nscf").removeClass("alert alert-success"),$("#nscf").addClass("alert alert-danger"),$("#nscf").fadeIn("fast"),$("#nscf").html("Table for <strong>"+a+"</strong> already exists!"),$("#nscf").fadeOut(3e3)):$.ajax({type:"POST",url:`${u}/schedule/add_schedule`,dataType:"JSON",data:{d:a},success:function(s){$.ajax({type:"POST",url:`${u}/schedule/create_schedule`,dataType:"JSON",data:{d:a},success:function(s){$.ajax({type:"POST",url:`${u}/schedule/insert_teachers`,dataType:"JSON",data:{d:a},success:function(s){t(),e(),$("#nscf").removeClass("alert alert-danger"),$("#nscf").addClass("alert alert-success"),$("#nscf").fadeIn("fast"),$("#nscf").html("Table <strong>"+a+"</strong> created!"),$("#nscf").fadeOut(3e3)}})}})}})}})}),$("#schedule_list").on("click",".schedule_list_item",function(){var e=$(this).data("d");t(e),$("#schedule_date").val(e)}),$("#my_schedule").on("focusin",".edit",function(){$(this).addClass("editMode");var e=$(this).data("id"),t=$(this).data("col"),s=$(this).text(),n=$("#schedule_date").val(),d="",c="";$(this).on("focusout",function(){$(this).removeClass("editMode");var l=$(this).text();s!=l&&t.indexOf("p")==-1&&t.indexOf("r")==-1&&(d=t+"n",isNaN(l)?(c="",$.ajax({url:`${u}/schedule/set_nick_name`,type:"post",dataType:"json",data:{id:e,nick_name:c,col:d,d:n},success:function(s){console.log("nick name set"),a(e,t,l,n)}})):$.ajax({url:`${u}/schedule/get_nick_name`,type:"post",dataType:"json",data:{str:l},success:function(s){""!=s&&(c=s[0].nick_name,$.ajax({url:`${u}/schedule/set_nick_name`,type:"post",dataType:"json",data:{id:e,nick_name:c,col:d,d:n},success:function(s){console.log("nick name set"),a(e,t,l,n)}}))}}))})}),$("#note").on("focusin",function(){$(this).addClass("editMode");var e=$(this).text();$("#schedule_date").val();$("#str").val(e)}),$("#note").on("focusout",function(){$(this).removeClass("editMode");var e=$("#str").val(),a=$(this).text(),s=$("#schedule_date").val();e!=a&&$.ajax({type:"post",url:`${u}/schedule/update_note`,dataType:"json",data:{d:s,str:a},success:function(e){t()}})}),$("#new_teacher_button").on("click",function(){$("#new_teacher_modal").modal("show")}),$("#add_teacher").on("submit",function(e){e.preventDefault();var a=$("#teacher_name").val(),s=$("#schedule_date").val();""==a?($("#ntf").addClass("alert alert-danger"),$("#ntf").html("It can't be empty")):$.ajax({url:`${u}/schedule/add_teacher`,method:"POST",dataType:"JSON",data:{name:a,d:s},success:function(e){$("#new_teacher_modal").modal("hide"),$("#teacher_name").val(""),$("#nscf").removeClass("alert alert-danger"),$("#nscf").addClass("alert alert-success"),$("#nscf").fadeIn("fast"),$("#nscf").html("Teacher added!"),$("#nscf").fadeOut(5e3),t()}})}),$("#my_schedule").on("click",".teacher_delete",function(){var e=$(this).data("id");$("#id").val(e),$("#delete_teacher_modal").modal("show")}),$("#btn_delete_teacher").on("click",function(){var e=$("#id").val(),a=$("#schedule_date").val();$.ajax({type:"POST",url:`${u}/schedule/delete_teacher`,dataType:"JSON",data:{id:e,d:a},success:function(e){$("#delete_teacher_modal").modal("hide"),$("#nscf").removeClass("alert alert-success"),$("#nscf").addClass("alert alert-danger"),$("#nscf").fadeIn("fast"),$("#nscf").html("Teacher removed!"),$("#nscf").fadeOut(5e3),t()}})})});
